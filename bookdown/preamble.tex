% Don't hyphenate
\usepackage[none]{hyphenat}

% Widow control, orphan control
\usepackage[defaultlines=4,all]{nowidow}

% Page style
\pagestyle{plain}
  % Footnotes
  \addtolength{\skip\footins}{1.5pc plus 5pt} % Footnote spacing from text
  \setlength{\footnotesep}{1.2pc} % Space between footnotes

% CS colors
\usepackage{xcolor}
\definecolor{CSblue}{HTML}{3960A5}
\definecolor{CSbluelight}{HTML}{4878CE}
\definecolor{CSgreen}{HTML}{008000}
\definecolor{chap}{HTML}{E03616}
\definecolor{calloutbackground}{HTML}{F2F3F4}
\definecolor{calloutborder}{HTML}{0096C8}

% Font
  
  %% Main serif fonts with math
    \usepackage{amsmath}
    \usepackage{fontspec}
    \defaultfontfeatures{Ligatures=TeX}
    \setmainfont{STIXTwoText}[ 
    Extension = {.otf}, 
    UprightFont = {*-Regular}, 
    ItalicFont = {*-Italic}, 
    BoldFont = {*-Bold}, 
    BoldItalicFont = {*-BoldItalic}
    ]
    \setmathfont{STIX Two Math}
    \setmathfont{STIX Two Math}[range={scr,bfscr}, StylisticSet=1]
    \usepackage{bm} 
 
    %% Sans serif font
    \usepackage[sfdefault]{sourcesanspro}


% Reduce space before lists
\usepackage{enumitem}
\setlist[itemize]{noitemsep, nolistsep, topsep=0pt}

% Package to tweak width
\usepackage{varwidth}

% Captions and subfigures
\usepackage{caption}
\captionsetup[figure]{
  width=0.8\linewidth,
  skip=6pt,
  labelfont={color=black,bf},
  font={small,sf,color=black},
  format=hang,
  indention=-2em,}
\captionsetup[table]{
  width=0.8\linewidth,
  labelfont={color=black,bf},
  font={small,sf,color=black},
  format=hang,
  indention=-2em,
}
\usepackage{subfig}
%\setlength\abovecaptionskip{-5pt}

% Package for math tables
\usepackage{array}

% For positioning figures
\usepackage{wrapfig}
\usepackage{float}
\floatplacement{figure}{htb}
\renewcommand{\topfraction}{.85}
\renewcommand{\bottomfraction}{.7}
\renewcommand{\textfraction}{.15}
\renewcommand{\floatpagefraction}{.66}
\setcounter{topnumber}{3}
\setcounter{bottomnumber}{3}
\setcounter{totalnumber}{4}

% Titles and chapters
\usepackage{sectsty}
\allsectionsfont{\bfseries\sourcesanspro\color{chap}}
\sectionfont{\bfseries\LARGE\sourcesanspro\color{chap}}
\subsectionfont{\bfseries\Large\sourcesanspro\color{chap}}
\subsubsectionfont{\bfseries\large\sourcesanspro\color{black}}
\usepackage[nobottomtitles*]{titlesec}
\titlespacing\section{0pt}{12pt plus 4pt minus 2pt}{8pt plus 4pt minus 2pt}
\titlespacing\subsection{0pt}{8pt plus 4pt minus 2pt}{6pt plus 4pt minus 2pt}
\titlespacing\subsubsection{0pt}{6pt plus 4pt minus 2pt}{4pt plus 4pt minus 2pt}

  %% Chapter number and title in the same line
  \titleformat{\chapter}[display]
    {\normalfont\Large\bfseries\sourcesanspro\color{black}}
    {\chaptertitlename\ \thechapter}{0em}
    {\Huge\bfseries\sourcesanspro\color{chap}}

  %% Section and subsection number on margin
  \titleformat{\section}
    {\normalfont\LARGE\bfseries\sourcesanspro\color{chap}}
    {\llap{
      \thesection\hskip 1em}}
    {0em} 
    {}

  \titleformat{\subsection}
    {\normalfont\Large\bfseries\sourcesanspro\color{chap}}
    {\llap{
      \thesubsection\hskip 1em}}
    {0em} 
    {} 

  \titleformat{\subsubsection}
    {\normalfont\large\bfseries\sourcesanspro\color{black}}
    {\llap{
      \thesubsubsection\hskip 1em}}
    {0em} 
    {}

% Keep things together, page breaks
\makeatletter       
\@secpenalty=1000      %% <- breaks before section heading
\@beginparpenalty\@M %% <- high value prevents break before list environments
\@endparpenalty=0   %% <- high value prevents breaks at end of list environments
\@itempenalty=0     %% <- high value prevents breaks between items
\makeatother        

% Don't add too much whitespace, keep ragged bottom if needed
\usepackage{ragged2e}
\raggedbottom

% Adding a framed box around text
\usepackage[most]{tcolorbox}

\newtcolorbox{callout}[1][]{%
  enhanced jigsaw, % so it doesn't draw bottom line if page breaks
  colback=calloutbackground,
  colframe=calloutborder,
  parbox=false,
  boxrule=1pt,
  fontupper=\sourcesanspro\small,
  breakable = true,
  title={#1},
  fonttitle=\bfseries\sourcesanspro\normalsize,
  sharp corners,
  rounded corners = uphill,
  arc=10pt,
  toptitle=0.4em,
  bottomtitle=0.4em,
  %float=h, % allows tcolorbox to float
}

% Shrink space between figure and rest
%\BeforeBeginEnvironment{figure}{\vskip-1em}
%\AfterEndEnvironment{figure}{\vskip-1em}

% tcolorbox to keep text together
\newtcolorbox{keepTogether}{%
  breakable = false,
  parbox = true,
  blanker,
}

% Theorems
\usepackage{ntheorem}
\usepackage{mdframed}

  % Definition
  %\theorembodyfont{\normalfont}
  \theoremseparator{\smallskip}
  \theoremstyle{break}

  \newmdtheoremenv[
    ntheorem = true,
    topline = false,
    bottomline = false,
    rightline = true,
    innerleftmargin = 10pt, % default 10pt
    innerrightmargin = 10pt, % default 10pt
    %innertopmargin = 0pt, % default 5pt
    %innerbottommargin = 0pt, % default 5pt
    linecolor = chap,
    leftline = true,
    linewidth = 3pt,
    splittopskip = 0pt,
    splitbottomskip = 0pt,
  ]{definition}{Definition}[chapter]

  % Example
  \theoremstyle{break}
  \theorembodyfont{\normalfont}
  \newmdtheoremenv[
    ntheorem = true,
    topline = false,
    bottomline = false,
    rightline = false,
    innerleftmargin = 10pt, % default 10pt
    innerrightmargin = 10pt, % default 10pt
    %innertopmargin = 0pt, % default 5pt
    %innerbottommargin = 0pt, % default 5pt
    linecolor = black,
    leftline = true,
    linewidth = 1pt,
    splittopskip = 0pt,
    splitbottomskip = 0pt,
  ]{example}{Example}[chapter]


% Dependencies for merging with external cover page
\usepackage{pdfpages}
\let\oldmaketitle\maketitle
\AtBeginDocument{\let\maketitle\relax}
